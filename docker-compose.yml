services:
  opensearch:
    image: opensearchproject/opensearch:latest
    container_name: opensearch
    environment:
      - discovery.type=single-node
      - cluster.name=opensearch-local
      - node.name=opensearch-1

      - DISABLE_SECURITY_PLUGIN=true
      # Java heap (tune based on your Mac RAM)
      - OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g

      # Reduce noisy bootstrap checks for local dev (still OK)
      - bootstrap.memory_lock=true

    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536

    ports:
      - "9200:9200"   # OpenSearch API
      - "9600:9600"   # Performance analyzer

    volumes:
      - ./opensearch-data:/usr/share/opensearch/data
      - ./opensearch-logs:/usr/share/opensearch/logs

    healthcheck:
      test: ["CMD-SHELL", "curl -k -s http://localhost:9200 >/dev/null || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 30

  dashboards:
    image: opensearchproject/opensearch-dashboards:latest
    container_name: opensearch-dashboards
    depends_on:
      opensearch:
        condition: service_healthy
    environment:
      - OPENSEARCH_HOSTS=["http://opensearch:9200"]
      - DISABLE_SECURITY_DASHBOARDS_PLUGIN=true    

    ports:
      - "5601:5601"

